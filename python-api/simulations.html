<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Controlling simulations - DQCsim</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Introduction to DQCsim</a></li><li><ol class="section"><li class="expanded "><a href="../intro/components.html"><strong aria-hidden="true">1.1.</strong> The components of a simulation</a></li><li><ol class="section"><li class="expanded "><a href="../intro/frontend.html"><strong aria-hidden="true">1.1.1.</strong> Frontend use cases</a></li><li class="expanded "><a href="../intro/backend.html"><strong aria-hidden="true">1.1.2.</strong> Backend use cases</a></li><li class="expanded "><a href="../intro/operator.html"><strong aria-hidden="true">1.1.3.</strong> Operator use cases</a></li><li class="expanded "><a href="../intro/host.html"><strong aria-hidden="true">1.1.4.</strong> Host use cases</a></li></ol></li><li class="expanded "><a href="../intro/puzzle.html"><strong aria-hidden="true">1.2.</strong> Jigsaw puzzle analogy</a></li><li class="expanded "><a href="../intro/interfaces.html"><strong aria-hidden="true">1.3.</strong> DQCsim's interfaces</a></li><li><ol class="section"><li class="expanded "><a href="../intro/arbs.html"><strong aria-hidden="true">1.3.1.</strong> ArbData and ArbCmds</a></li><li class="expanded "><a href="../intro/gatestream.html"><strong aria-hidden="true">1.3.2.</strong> Gate- and measurement streams</a></li><li class="expanded "><a href="../intro/host-iface.html"><strong aria-hidden="true">1.3.3.</strong> The host interface</a></li><li class="expanded "><a href="../intro/misc-iface.html"><strong aria-hidden="true">1.3.4.</strong> Miscellaneous interfaces</a></li></ol></li><li class="expanded "><a href="../intro/reproducibility.html"><strong aria-hidden="true">1.4.</strong> Reproducibility</a></li></ol></li><li class="expanded "><a href="../install/index.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li><ol class="section"><li class="expanded "><a href="../install/plugins.html"><strong aria-hidden="true">2.1.</strong> Plugin distribution</a></li></ol></li><li class="expanded "><a href="../cli/index.html"><strong aria-hidden="true">3.</strong> The command-line interface</a></li><li class="expanded "><a href="../python-api/index.html"><strong aria-hidden="true">4.</strong> Python API</a></li><li><ol class="section"><li class="expanded "><a href="../python-api/hello-world.html"><strong aria-hidden="true">4.1.</strong> Hello, world!</a></li><li class="expanded "><a href="../python-api/debugging.html"><strong aria-hidden="true">4.2.</strong> Debugging</a></li><li class="expanded "><a href="../python-api/sending-gates.html"><strong aria-hidden="true">4.3.</strong> Sending some gates</a></li><li class="expanded "><a href="../python-api/simulations.html" class="active"><strong aria-hidden="true">4.4.</strong> Controlling simulations</a></li><li class="expanded "><a href="../python-api/operator.html"><strong aria-hidden="true">4.5.</strong> Inserting an operator</a></li><li class="expanded "><a href="../python-api/reference.html"><strong aria-hidden="true">4.6.</strong> Reference</a></li></ol></li><li class="expanded "><a href="../c-api/index.html"><strong aria-hidden="true">5.</strong> C API</a></li><li><ol class="section"><li class="expanded "><a href="../c-api/usage.html"><strong aria-hidden="true">5.1.</strong> Usage</a></li><li class="expanded "><a href="../c-api/concepts.apigen.html"><strong aria-hidden="true">5.2.</strong> Concepts</a></li><li><ol class="section"><li class="expanded "><a href="../c-api/handle.apigen.html"><strong aria-hidden="true">5.2.1.</strong> Handles: dqcs_handle_*</a></li><li class="expanded "><a href="../c-api/memory-management.apigen.html"><strong aria-hidden="true">5.2.2.</strong> Memory management</a></li><li class="expanded "><a href="../c-api/error.apigen.html"><strong aria-hidden="true">5.2.3.</strong> Error handling: dqcs_error_*</a></li><li class="expanded "><a href="../c-api/callbacks.apigen.html"><strong aria-hidden="true">5.2.4.</strong> Callbacks</a></li></ol></li><li class="expanded "><a href="../c-api/type-definitions.apigen.html"><strong aria-hidden="true">5.3.</strong> Type definitions: dqcs_*_t</a></li><li class="expanded "><a href="../c-api/arb-cmd-cq.apigen.html"><strong aria-hidden="true">5.4.</strong> ArbData and ArbCmd objects</a></li><li><ol class="section"><li class="expanded "><a href="../c-api/arb.apigen.html"><strong aria-hidden="true">5.4.1.</strong> ArbData objects: dqcs_arb_*</a></li><li class="expanded "><a href="../c-api/cmd.apigen.html"><strong aria-hidden="true">5.4.2.</strong> ArbCmd objects: dqcs_cmd_*</a></li><li class="expanded "><a href="../c-api/cq.apigen.html"><strong aria-hidden="true">5.4.3.</strong> ArbCmd queues: dqcs_cq_*</a></li></ol></li><li class="expanded "><a href="../c-api/qbset.apigen.html"><strong aria-hidden="true">5.5.</strong> Qubits: dqcs_qbset_*</a></li><li class="expanded "><a href="../c-api/mat.apigen.html"><strong aria-hidden="true">5.6.</strong> Matrices: dqcs_mat_*</a></li><li class="expanded "><a href="../c-api/gate.apigen.html"><strong aria-hidden="true">5.7.</strong> Gates: dqcs_gate_*</a></li><li class="expanded "><a href="../c-api/gm.apigen.html"><strong aria-hidden="true">5.8.</strong> Gate maps: dqcs_gm_*</a></li><li class="expanded "><a href="../c-api/measurements.apigen.html"><strong aria-hidden="true">5.9.</strong> Measurements</a></li><li><ol class="section"><li class="expanded "><a href="../c-api/meas.apigen.html"><strong aria-hidden="true">5.9.1.</strong> Singular measurements: dqcs_meas_*</a></li><li class="expanded "><a href="../c-api/mset.apigen.html"><strong aria-hidden="true">5.9.2.</strong> Measurement sets: dqcs_mset_*</a></li></ol></li><li class="expanded "><a href="../c-api/plugins.apigen.html"><strong aria-hidden="true">5.10.</strong> Plugins</a></li><li><ol class="section"><li class="expanded "><a href="../c-api/pdef.apigen.html"><strong aria-hidden="true">5.10.1.</strong> Defining a plugin: dqcs_pdef_*</a></li><li class="expanded "><a href="../c-api/plugin-run.apigen.html"><strong aria-hidden="true">5.10.2.</strong> Running a plugin: dqcs_plugin_*</a></li><li class="expanded "><a href="../c-api/plugin-interact.apigen.html"><strong aria-hidden="true">5.10.3.</strong> Interacting with DQCsim: dqcs_plugin_*</a></li><li class="expanded "><a href="../c-api/log.apigen.html"><strong aria-hidden="true">5.10.4.</strong> Logging: dqcs_log_*</a></li></ol></li><li class="expanded "><a href="../c-api/simulations.apigen.html"><strong aria-hidden="true">5.11.</strong> Simulations</a></li><li><ol class="section"><li class="expanded "><a href="../c-api/pcfg.apigen.html"><strong aria-hidden="true">5.11.1.</strong> Configuring plugins: dqcs_pcfg_*</a></li><li class="expanded "><a href="../c-api/tcfg.apigen.html"><strong aria-hidden="true">5.11.2.</strong> Running local plugins: dqcs_tcfg_*</a></li><li class="expanded "><a href="../c-api/scfg.apigen.html"><strong aria-hidden="true">5.11.3.</strong> Configuring a simulation: dqcs_scfg_*</a></li><li class="expanded "><a href="../c-api/sim.apigen.html"><strong aria-hidden="true">5.11.4.</strong> Running a simulation: dqcs_sim_*</a></li></ol></li><li class="expanded "><a href="../c-api/reference.apigen.html"><strong aria-hidden="true">5.12.</strong> Reference</a></li></ol></li><li class="expanded "><a href="../cpp-api/index.html"><strong aria-hidden="true">6.</strong> C++ API</a></li><li><ol class="section"><li class="expanded "><a href="../cpp-api/usage.html"><strong aria-hidden="true">6.1.</strong> Usage</a></li><li class="expanded "><a href="../cpp-api/ccompare.html"><strong aria-hidden="true">6.2.</strong> Comparison to the C API</a></li><li class="expanded "><a href="../cpp-api/plugin.html"><strong aria-hidden="true">6.3.</strong> Plugin anatomy</a></li><li class="expanded "><a href="../cpp-api/sim.html"><strong aria-hidden="true">6.4.</strong> Host/simulation anatomy</a></li><li class="expanded "><a href="../cpp-api/reference.html"><strong aria-hidden="true">6.5.</strong> Reference</a></li></ol></li><li class="expanded "><a href="../rust-api/index.html"><strong aria-hidden="true">7.</strong> Rust API</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">DQCsim</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#controlling-simulations" id="controlling-simulations">Controlling simulations</a></h1>
<p>Right now, our Deutsch-Jozsa algorithm always executes all oracles once and
logs the results. This is fine when you just want to run it once, but what if
you want to run it 1000 times, maybe with an error model in between, and apply
some statistics to the results? You could of course make a script that just
calls the DQCsim command line 1000 times and parses the stderr stream for every
call... but that would be a very fragile solution, and it'd be annoying to
make.</p>
<p>Instead, we can use DQCsim's host interface. Let's change the frontend plugin
to make use of this feature.</p>
<pre><code class="language-python">from dqcsim.plugin import *

@plugin(&quot;Deutsch-Jozsa&quot;, &quot;Tutorial&quot;, &quot;0.2&quot;)
class MyPlugin(Frontend):

    def oracle_constant_0(self, qi, qo):
        &quot;&quot;&quot;x -&gt; 0 oracle function.&quot;&quot;&quot;
        pass

    def oracle_constant_1(self, qi, qo):
        &quot;&quot;&quot;x -&gt; 1 oracle function.&quot;&quot;&quot;
        self.x_gate(qo)

    def oracle_passthrough(self, qi, qo):
        &quot;&quot;&quot;x -&gt; x oracle function.&quot;&quot;&quot;
        self.cnot_gate(qi, qo)

    def oracle_invert(self, qi, qo):
        &quot;&quot;&quot;x -&gt; !x oracle function.&quot;&quot;&quot;
        self.cnot_gate(qi, qo)
        self.x_gate(qo)

    def deutsch_jozsa(self, qi, qo, oracle):
        &quot;&quot;&quot;Runs the Deutsch-Jozsa algorithm on the given oracle. The oracle is
        called with the input and output qubits as positional arguments.&quot;&quot;&quot;

        # Prepare the input qubit.
        self.prepare(qi)
        self.x_gate(qi)
        self.h_gate(qi)

        # Prepare the output qubit.
        self.prepare(qo)
        self.h_gate(qo)

        # Run the oracle function.
        oracle(qi, qo)

        # Measure the output.
        self.h_gate(qo)
        self.measure(qo)
        if self.get_measurement(qo).value:
            self.send(result='balanced')
        else:
            self.send(result='constant')

    def handle_run(self, oracle='', runs=1):

        oracle = {
            '0': self.oracle_constant_0,
            '1': self.oracle_constant_1,
            'x': self.oracle_passthrough,
            '!x': self.oracle_invert,
        }.get(oracle, None)

        if oracle is None:
            raise ValueError('Please specify an oracle!')

        qi, qo = self.allocate(2)

        for _ in range(runs):
            self.deutsch_jozsa(qi, qo, oracle)

        self.free(qi, qo)

MyPlugin().run()
</code></pre>
<p>When we try to run this frontend with DQCsim's command line, you'll get an
error:</p>
<pre><code class="language-console">$ dqcsim my-plugin.py null
...  Info dqcsim  Starting Simulation with seed: 15043164643727486506
...  Info back    Running null backend initialization callback
...  Info dqcsim  Executing 'start(...)' host call...
...  Info dqcsim  Executing 'wait()' host call...
... Error front   Please specify an oracle!
...  Info dqcsim  Reproduction file written to &quot;my-plugin.py.repro&quot;.
... Fatal dqcsim  Simulation failed: Please specify an oracle!
...  Info dqcsim  PluginProcess exited with status code: 0
...  Info dqcsim  PluginProcess exited with status code: 0
</code></pre>
<p>Indeed, we've changed the algorithm such that our <code>handle_run()</code> callback wants
some arguments.</p>
<p>Remember how the <a href="../intro/host-iface.html#algorithm-execution"><code>start()</code> call takes an <code>ArbData</code> as argument</a>?
The Python module passes the contents of this <code>ArbData</code> as arguments to
<code>handle_run()</code>. Specifically, the binary strings are passed as positional
arguments (<code>*args</code>), and the toplevel entries in the JSON/CBOR object are
passed as keyword arguments (<code>**kwargs</code>). This abstraction is used all over
the place in the Python layer, including when you have to send an <code>ArbData</code>
with it, because it gives the callbacks a nice, Pythonic interface.</p>
<p>It's possible to tell the command-line interface to pass arguments to the
<code>start()</code> call as follows, though the syntax isn't very friendly:</p>
<pre><code class="language-console">$ dqcsim -C 'start:{&quot;oracle&quot;:&quot;x&quot;}' my-plugin.py null
... Info dqcsim  Starting Simulation with seed: 13451103132954817086
... Info back    Running null backend initialization callback
... Info dqcsim  Executing 'start(...)' host call...
... Info dqcsim  Executing 'wait()' host call...
... Note dqcsim  'wait()' returned {}
... Info dqcsim  Reproduction file written to &quot;my-plugin.py.repro&quot;.
... Info dqcsim  Simulation completed successfully.
... Info dqcsim  PluginProcess exited with status code: 0
... Info dqcsim  PluginProcess exited with status code: 0
</code></pre>
<p>Now we don't get an error anymore... but we also don't get any output. Look
again at the revised Python script: instead of logging the results, we <code>send()</code>
them. <code>send()</code> takes an <code>ArbData</code> as argument, and thus, like the syntax we
used for our <code>handle_run()</code> callback, we can construct it by passing positional
and keyword arguments.</p>
<p>To see the result, we need to make DQCsim call <code>recv()</code> before it exits. We can
do that through the command line as well:</p>
<pre><code class="language-console">$ dqcsim -C 'start:{&quot;oracle&quot;:&quot;x&quot;}' -C recv my-plugin.py null
... Info dqcsim  Starting Simulation with seed: 8371252716093296353
... Info back    Running null backend initialization callback
... Info dqcsim  Executing 'start(...)' host call...
... Info dqcsim  Executing 'recv()' host call...
... Note dqcsim  'recv()' returned {&quot;result&quot;:&quot;balanced&quot;}
... Info dqcsim  Executing 'wait()' host call...
... Note dqcsim  'wait()' returned {}
... Info dqcsim  Reproduction file written to &quot;my-plugin.py.repro&quot;.
... Info dqcsim  Simulation completed successfully.
... Info dqcsim  PluginProcess exited with status code: 0
... Info dqcsim  PluginProcess exited with status code: 0
</code></pre>
<p>Now <code>dqcsim</code> notes that the <code>recv()</code> call returned <code>{&quot;result&quot;:&quot;balanced&quot;}</code>,
which coincidentally is the correct output of the algorithm. Since we're still
using the <code>null</code> backend, the result is just 50/50.</p>
<h2><a class="header" href="#constructing-an-accompanying-host-program" id="constructing-an-accompanying-host-program">Constructing an accompanying host program</a></h2>
<p>It makes little sense to do all that work only to get a less convenient
command-line interface. Indeed, this mechanism is not intended to be used this
way. You should use it with a host program instead.</p>
<p>You can write this in any of the languages DQCsim supports, since it runs in a
different process. But since this is a Python tutorial, we'll use Python.</p>
<p>Here's an example of a host program that makes use of our modified frontend.</p>
<pre><code class="language-python">from dqcsim.host import *

runs = 1000
oracle = 'x'

with Simulator('my-plugin.py', 'null') as sim:
    sim.start(oracle=oracle, runs=runs)
    results = [sim.recv()['result'] for _ in range(runs)]
    sim.wait()

print('Number of balanced outcomes:', results.count('balanced'))
print('Number of constant outcomes:', results.count('constant'))
</code></pre>
<p>Calling this script may yield the following:</p>
<pre><code class="language-console">$ python3 simulate.py
... Info dqcsim  Starting Simulation with seed: 14750381695807274720
... Info back    Running null backend initialization callback
... Info dqcsim  PluginProcess exited with status code: 0
... Info dqcsim  PluginProcess exited with status code: 0
Number of balanced outcomes: 493
Number of constant outcomes: 507
</code></pre>
<p>Let's dissect this script.</p>
<pre><code class="language-python">from dqcsim.host import *
</code></pre>
<p>This line loads DQCsim's host library and brings it into scope. Specifically,
we're using the <code>Simulator</code> class.</p>
<pre><code class="language-python">runs = 1000
oracle = 'x'
</code></pre>
<p>These variables set the number of runs and the oracle under test.</p>
<pre><code class="language-python">with Simulator('my-plugin.py', 'null') as sim:
</code></pre>
<p>This line starts a simulation. You can call the <code>Simulator()</code> constructor in
<a href="../py_/dqcsim/host/index.html">many different ways</a>;
the one we're using here is very similar to the command line we used before.
However, instead of using strings to try to hack a list of host calls in there
(which isn't even supported by the constructor), we'll interact with the
simulation while it's running.</p>
<p>The <code>with</code> syntax used here is shorthand notation for the following:</p>
<pre><code class="language-python">sim = Simulator('my-plugin.py', 'null')
sim.simulate()
# block contents
sim.stop()
</code></pre>
<p>Calling the <code>Simulator()</code> constructor doesn't really do anything yet; it just
<em>configures</em> a simulation. In fact, you're free to use it more than once, as
long as you don't try to have multiple simulations running at the same time.</p>
<p>The <code>simulate()</code> function actually starts the simulation, in the sense that it
spawns the plugins and calls their initialization callbacks (if applicable),
but it doens't call our <code>handle_run()</code> callback yet. The <code>stop()</code> function
performs the inverse operation of <code>simulate()</code>; it ensures that all the spawned
processes get cleaned up.</p>
<pre><code class="language-python">sim.start(oracle=oracle, runs=runs)
</code></pre>
<p>This line actually starts the simulation. The keyword arguments specified are
used to construct the <code>ArbData</code> argument, which the plugin library unpacks into
keyword arguments again when it calls <code>handle_run()</code>.</p>
<pre><code class="language-python">results = [sim.recv()['result'] for _ in range(runs)]
</code></pre>
<p>This <a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions">list comprehension</a>
calls <code>recv()</code> just as many times as the algorithm runs for, and records the
<code>result</code> key of the returned <code>ArbData</code> object into a list. These entries should
be either <code>'balanced'</code> or <code>'constant'</code>.</p>
<p>Note that there is a possibility of a deadlock here: if the algorithm wouldn't
call <code>send()</code> as often as we expect, everything would logically lock up.
DQCsim detects all possible kinds of deadlocks on the host interface however,
and immediately throws an exception instead. Try it out!</p>
<pre><code class="language-python">sim.wait()
</code></pre>
<p>This line waits for the <code>handle_run()</code> callback to return. <code>wait()</code> returns an
<code>ArbData</code> object corresponding to what the <code>handle_run()</code> returned, but we're
not using that feature, so we just discard it.</p>
<pre><code class="language-python">print('Number of balanced outcomes:', results.count('balanced'))
print('Number of constant outcomes:', results.count('constant'))
</code></pre>
<p>These two lines count the number of <code>'balanced'</code> vs. <code>'constant'</code> occurrences
in the result list. As we can see when we run the script, the chance is 50/50.
With a perfect qubit simulator backend you should get 1000 balanced and zero
constant outcomes. When you add an error model to the simulation, you might get
something in between.</p>
<p>Note that we're using regular print statements here, versus using DQCsim's log
system. In fact, we have to do this: DQCsim's log system is intended for the
plugins only. You can, however, instruct the <code>Simulator()</code> object to forward
the messages it receives to Python's <code>logging</code> library to get uniform output.
This is beyond the scope of this tutorial.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../python-api/sending-gates.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../python-api/operator.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../python-api/sending-gates.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../python-api/operator.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
