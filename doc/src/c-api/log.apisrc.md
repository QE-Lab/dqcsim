# Logging

DQCsim provides a centralized logging interface for plugins. This ensures that
log messages are processed in a consistent way among different plugins. It also
makes sure that messages don't print "through" each other, as they would when
stdout/stderr were used directly (these are not thread-safe).

The logging interface is only available from within threads that are hosting a
plugin (or the main thread of a plugin process) and the thread which started
the simulation.

## Log levels

Every message has a severity level associated with it. These severities should
be interpreted as follows:

 - `trace` is intended for reporting debugging information useful for debugging
   the internals of the originating plugin, but not necessarily for debugging
   the plugins around it. Such messages would normally only be generated by
   debug builds, to prevent them from impacting performance under normal
   circumstances.
 - `debug` is intended for reporting debugging information which may also be
   useful when debugging the plugins around it, such as the arguments with
   which a public API function was called.
 - `info` is intended for reporting information that was *not* explicitly
   requested by the user, such as a plugin starting up or shutting down.
 - `note` is intended for reporting information that *was* explicitly requested
   by the user/API caller, such as the result of an API function requested
   through the command line, or an explicitly captured stdout/stderr stream. It
   may also be used for reporting events that the user may not be expecting,
   but are not exceptional enough to warrent issuing a warning.
 - `warn` is intended for reporting that a third party did something
   unexpected, but that an attempt will be made to work around the problem,
   such as a failed connection attempt that we're going to retry.
 - `error` is intended for reporting or propagating a non-fatal error, such as
   a third party requesting usage of an unimplemented function.
 - `fatal` is intended for reporting fatal errors, such as a third party
   reporting an error for something that we really needed.

## Sending log messages

The preferred way for C programs to submit log messages is through the
following macros. These automatically add information such as line number and
source filename through the C preprocessor. They also fall back to writing to
`stderr` if logging fails for some reason. Their interface is just like
`printf`, but the final newline is implicit.

@@@c_api_gen ^dqcs_log_(?!raw)(?!format)@@@

To get more control over the metadata or to set the loglevel programmatically,
you can use the following function.

@@@c_api_gen ^dqcs_log_format$@@@

The above macros and functions ultimately call `dqcs_log_raw()`. This function
does not fall back to `stderr` if logging fails, and does not support
`printf`-style format strings. The latter may be useful for interfacing with
languages that don't support calling variadic functions.

@@@c_api_gen ^dqcs_log_raw$@@@

## stdout and stderr

By default, DQCsim will capture the stdout and stderr streams of the plugin
processes it launches. Each received line will simply be turned into a log
message. This is particularly useful for logging problems related to
connecting to DQCsim.
