parameters:
  rust: stable
  components: False

steps:

- script: |
    rustup update ${{ parameters.rust }}
  condition: eq(variables['Agent.OS'], 'Linux')
  displayName: Use Rust ${{ parameters.rust }} (Linux)

- script: |
    curl https://sh.rustup.rs -sSf | sh -s -- -y --default-toolchain ${{ parameters.rust }}
    echo "##vso[task.prependpath]$HOME/.cargo/bin"
  condition: eq(variables['Agent.OS'], 'Darwin')
  displayName: Use Rust ${{ parameters.rust }} (macOS)

- script: |
    rustup component add clippy rustfmt --toolchain=${{ parameters.rust }}
  condition: and(eq(variables['Agent.OS'], 'Darwin'), eq(${{ parameters.components }}, True))
  displayName: Add Rust components (macOS)
